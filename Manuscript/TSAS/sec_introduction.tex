\section{Introduction}
\label{sec:intro}
%TO-DO lists:
%\begin{itemize}
%	\item Problem definition: define driver profile, rider profile and our price model.
%	
%	\item Define our objective functions (i.e., maximize extra profit), and differentiate it with other optimization goal (e.g., minimize extra distance). 
%	%Given a rider and a driver with their profiles, calculate the cost of accepting the rider. 
%	
%	\item Introduce overall framework, and describe our auction-based mechanism.
%	
%	\item Properties of our framework in both local setting and global setting. In the local setting, show that we will get the same profit as the centralized setting. In the global setting, show that our technique can achieve certain approximation ratio compared with the global optimal (or upper bound of global optimal),  or vice verse we will suffer from certain degenerated cases.
%	
%	\item Optimizations: a) Maintain coarse-grained hierarchic index (adaptive grids, quad-tree), b) maintain novel shortest path index which is fine tuned for ride-sharing applications c) batch processing rider requests (single round bidding v.s. multi-round bidding).
%	
%\end{itemize}

%%%%%% 1. background information
% Ridesharing becomes popular recently because it has potential to match riders with similar itineraries and time schedules, and to bring significant benefits to individual users and the city as a whole. 

Real-time ride-sharing, as an alternative transportation service, alleviates traffic congestion and decreases auto emissions. With the emergence of many commercial platforms (e.g., Uber and Lyft), which automatically match drivers and riders on-the-fly, real-time ride-sharing becomes more and more popular. According to~\cite{uberpool}, millions of trips have been taken on UberPool since its launch at August 2014, and thousands of passengers take it five times a week during commuting hours. Enabled by the development and technology advances of smart phones and location-based services, ride-sharing platforms typically operate as follows: (1) Riders and drivers can join the platform via their smart phones, (2) a rider can submit a request, which consists of the pick-up and drop-off points, to the platform, (3) once a new request is received, the platform determines a driver (even en-route) to pick up the rider, (4) when the trip is completed, the platform calculates the rider's fare and the driver's income. With these platforms, riders can share a vehicle with reduced trip cost while enjoying fast and convenient transportation.

%%%%%% 2. explain the challengs and the detour of ridesharing......
Many challenges exist to enable such real-time ride-sharing platforms. From a business point of view, the platform provider (e.g., Uber) seeks to maximize its own profit. However, higher profits should not be at the cost of either charging passengers more or paying drivers less than what would compromise participation and retention due to no monetarily incentive for either parties. Consequently, the design of a fair pricing model becomes an essential business strategy. This is particularly important in cases of carpooling where riders share their ride with other riders. Even though carpooling reduces the riders' cost, it incurs extra distance (i.e., detour) for riders. While each rider's fare should be discounted as a function of the length of the detour, the driver should be rewarded more as the total travel distance is increased due to all detours. Furthermore, different users (i.e., riders and drivers) might value their time differently. Therefore, a fair pricing model should be available to both riders and drivers to express, for a certain amount of detour, how much discount or compensation they expect. Finally, in addition to fair pricing scheme for riders and drivers, the model should account for the provider's revenue as well.

The second challenge of a ride-sharing platform is to process incoming requests in real-time. This involves two different tasks: i) checking which drivers can add the new requests (new pick-up and drop-off locations) to their current trip without violating the constraints of that trip (i.e., scheduling) and ii) selecting the best driver among those who can serve the new request (i.e., matching). Processing the schedule of potentially thousands of drivers to check if they can accommodate a new request, with the additional task of matching their pricing profile with the incoming rider's profile, becomes computationally intensive. Therefore, the design of an efficient and scalable algorithm that assigns riders to drivers with a fair pricing model while maximizing the provider's revenue, is very challenging.


%First, the framework should consider the conflicting interests of different users (i.e., riders and drivers) and platform providers (e.g., Uber). For example, riders would like to arrive at their destination as quick and cheap as possible, whereas drivers and platform providers would like to maximize their profits. Although ride-sharing can reduce the cost of riders by sharing similar itineraries, it also incurs extra travel distance (i.e., detour). Ideally, riders are expected to be compensated for their detour, while drivers are expected to earn more profit. These factors makes the design of a fair pricing scheme (i.e., the fares and incomes) that satisfies the requirements of both riders and drivers even more complex. Secondly, because the riders requests are generated on-the-fly, the framework should decide the matching drivers (even en-route) at a short amount of time. Therefore, the design of an efficient framework that match riders and drivers, with a fair pricing scheme that provides incentives for all participants becomes a distinguishing business strategy. 

%%% 3. show the shortcomings of existing work and how they fail to address the challenge
The majority of previous studies~\cite{Ota15, Cici15, Cao15, PelzerITS15} focus on improving the efficiency of on-the-fly assignment with the objective of minimizing the total travel distance of drivers. In particular, in existing studies a new request is assigned to a driver who can fit the request in his schedule with the least amount of increase in the total traveled distance. However, minimizing drivers' total travel distance is not always equivalent to overall shorter trips for riders. Consequently, when assigning a new request, the driver who would incur the minimum increase in total travel distance is not necessarily the most cost effective option. To illustrate, suppose driver $a$ has two passengers on board and driver $b$ has only one. To serve an incoming request, \textit{a}'s incurred detour is 2 miles while for $b$ the detour is 3 miles. Even though $a$'s detour is shorter, the platform owner has to compensate both passengers of $a$ for 2 miles (a total of 4 miles) while in the case of $b$ it has to compensate only one passenger for a total of $3$ miles. In addition, from the riders' perspectives, in the first scenario two riders incur extra detour while in the second only one rider incurs an extra detour.  Few studies~\cite{Ma13,Ma15} consider a pricing model by defining monetary incentives for riders and drivers. In \cite{Ma13}, a pricing model is introduced where instead of being compensated, a rider can potentially end up being penalized for longer detours by paying a higher fare. Ma et. al.~\cite{Ma15} overcomes the unfairness issue in \cite{Ma13} to some extent. Even though, a new rider can incur detour in his trip, their model only compensates riders that are already on board. In addition, since this model is targeted for a different application, the notion of revenue fails to provide any incentive for the platform provider. Furthermore, in all previous studies~\cite{Ma13,Huang14,Ma15}, a centralized server is responsible for matching and scheduling incoming requests. Most of these studies utilize a spatiotemporal index to enable matching, i.e., narrowing down the number of potential drivers who can serve an incoming request. With thousands of drivers in the system, even after applying the spatial index, the centralized server still needs to perform scheduling and profile matching for all the candidate drivers. We show that with large number of drivers, these frameworks fail to process new requests in real-time (\cref{subsec:exprp}) and hence not scalable.


%in In \cite{Ma13}, a pricing model is introduced where instead of being compensated, a rider can potentially end up being penalized for longer detours by paying a higher fare. 

%In a recent study \cite{Ma15}, the pricing model overcomes the unfairness issue in \cite{Ma13} to some extent. Since riders can value their time differently, It also allows riders to accept/reject ride-sharing requests based on the amount they will be compensated for the incurred detour. However, drivers can similarly value their time different from each other. The pricing model in \cite{Ma15} does not provide any means for drivers to specify their monetary expectations for participating in the system. Furthermore, since this model only tends to divide the cost of the ride among riders, the notion of revenue is left out and it does not provide any incentive for the platform provider.


%%% 4. explain our pricing model, and provide more intuition of better service quality.
To address aforementioned challenges, in this paper, we introduce an Auction-based Price-Aware Real-time (\textit{APART}) ride-sharing framework. We propose a general and versatile pricing model that allows both riders and drivers to set their monetary expectations for participating in ride-sharing based on their predefined profiles. Specifically, each rider's profile defines the expected discount ratio for the detours incurred by ride-sharing. For example, one rider can express that he is willing to accept a 10 mile detour for 30\% discount. On the other hand, each driver's profile defines the expected cost in terms of his total travel distance and time. The model also accounts for the revenue of the platform provider. Consequently, our objective is to maximize the revenue of the ride-sharing framework while satisfying various temporal and monetary constraints of all users. APART is price-aware because a new request is assigned to a driver which generates the highest profit. Since our pricing model is designed to compensate riders for detours, the most profitable choice is also the one where \textit{riders} incur the least amount of detour, hence better service quality. Finally, APART also maximizes the revenue of the provider by increasing the service rate (throughput) in the system through engaging available drivers more effectively to serve more requests.


% With our price scheme, our objective is to maximize the total profit of the ridesharing platform, while satisfying the constraints of both riders and drivers.

% Because our pricing model compensates riders for longer trips, in order to maximize the profit, our framework reduces the detour of passengers and hence, providing better service quality. 

%We define a fair price model, which is flexible and general. The profiles are served to xxx. The constraints of are expressed as profiles. Given a user and rider profile, the fare and cost of xxx can be automatically derived from their profiles and other constrains. 

%%% 5. explain our framework
To efficiently assign riders to the candidate drivers, we introduce a distributed auction-based framework. With our framework, APART, the server broadcasts a new request to a set of candidate drivers and the mobile app of each candidate driver\footnote{Hereafter we use the term \qoutes{driver} to refer to both the human driver and the software running on his mobile device.} computes and submits a bid based on the driver's current schedule, his and his other passengers' profiles and other spatiotemporal constraints. Subsequently, the server collects all the bids from candidate drivers and assigns the rider to the highest bidding driver. To guarantee high service quality, each driver runs a branch-and-bound algorithm that performs an exhaustive search to find out whether it can fit a new request into its current scheduling. Each driver carries a small number of riders so even an exhaustive search can be performed in real-time. Due to the distributed nature of APART, all candidate drivers perform the search in parallel. Once each driver finds its own best schedule, the server simply selects the driver that generates the highest profit. Consequently, APART is able to find the most profitable drivers in real-time.


%With APART, the server does not need to know the exact location of every driver as it is not responsible for performing the scheduling phase. The grid index structure in APART, only needs to store which grid cell a driver is located in. Therefore, compared to a spatial index structure where the exact location of every driver is stored, APART's grid index requires fewer updates and less maintenance, which further reduces the load on the server.

%%% 6. show some experiment resutls

We conducted extensive experiments on a large scale New York City taxi dataset and show that APART is scalable and efficient, capable of processing hundreds of tasks per second in the presence of thousands of drivers. By comparing our framework with the state-of-the-art approaches~\cite{Huang14}, we show that our framework can simultaneously match up to 10\% more riders to drivers (i.e. higher service rate), while the total travel distance of riders are 20\% less (i.e., better service quality), hence our framework can generate more profit than other approaches with an even better service quality. On the other hand, we show that in a framework were riders are assigned to drivers with the least increase in the driver's travel distance, up to 25\% of the requests are not assigned to the most profitable driver. 

The remainder of this paper is organized as follows. We define our problem in \cref{sec:problem_def}, and explain our pricing model in \cref{sec:pricing}. We present our APART framework, and discuss its auction-based approach in \cref{sec:framework}. In \cref{sec:exp}, we report the experiment results. We discuss the related work in \cref{sec:related} and conclude the paper in \cref{sec:conclusion}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% from mohammod 

% Because platforms like Uber and Lyft are becoming more popular (we can show some numbers how their businesses are growing in the recent years). Ridesharing become popular recently. Existing ridesharing studies mainly focus on matching riders and drivers only considering their spatiotemporal constraints (max wait time, maximum detour, etc.)

% It is important to design systems that not only satisfy spatiotemporal constraints of the users, but also take into consideration the monetary aspect of the business (i.e., the fees riders pay, the drivers' income and the system's profit). A key component of such framework is to xxx and xxx.

% While most studies ignore this aspect of the system, T-Share provides a pricing model where on average riders end up paying less when compared to each passenger riding alone. However, based on some experimental results on NYC's taxi dataset, we noticed based on this pricing model, up to x\% of passengers end up paying even more that what they would have payed if they did not share a ride. Hence, this requires the design of a pricing model which is fair to every passenger meaning that if a passenger's trip gets longer as a result of sharing a ride, they should end up paying less (receiving a discount).

% To address the above challenges, in this paper we propose xxx. The goal of our framework is to maximize the profit of the platform. Because we utilize a pricing model which compensates riders for longer trips, in order to maximize the profit, our framework reduces the detour of passengers and hence, providing better service quality.

% Also, APART utilized an auction based approach allowing it to scale by distributing the computation among drivers (You can probably use a good chunk of this part from my CIKM submission).

% We evaluated our .

% The paper is organized as follows:
